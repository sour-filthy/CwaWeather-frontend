<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Taiwan Weather Whack-a-Mole</title>
    <style>
        :root {
            --ground-color: #8da25d;
            --hole-color: #5d4037;
            --sky-color: #87CEEB;
        }

        body {
            margin: 0;
            padding: 20px;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--ground-color);
            background-image: radial-gradient(#9db56a 15%, transparent 16%), radial-gradient(#9db56a 15%, transparent 16%);
            background-size: 60px 60px;
            background-position: 0 0, 30px 30px;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            overflow-x: hidden;
            cursor: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24"><path fill="%23FFF" stroke="%23000" stroke-width="2" d="M19.5 3.5L18 2l-1.5 1.5L15 2l-1.5 1.5L12 2l-1.5 1.5L9 2 7.5 3.5 6 2 4.5 3.5 3 2v20l1.5-1.5L6 22l1.5-1.5L9 22l1.5-1.5L12 22l1.5-1.5L15 22l1.5-1.5L18 22l1.5-1.5L21 22V2l-1.5 1.5z"/></svg>'), auto; /* Fun Hammer Cursor Concept */
        }

        h1 {
            color: white;
            text-shadow: 2px 2px 0 #333;
            margin-bottom: 30px;
            text-align: center;
        }

        /* Game Board Grid */
        .game-board {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
            gap: 40px 20px;
            width: 100%;
            max-width: 1000px;
            padding-bottom: 50px;
        }

        /* The Hole Container */
        .hole-container {
            position: relative;
            width: 120px;
            height: 100px;
            margin: 0 auto;
        }

        /* The Dirt Mound */
        .hole {
            width: 100%;
            height: 40px;
            background: var(--hole-color);
            border-radius: 50%;
            position: absolute;
            bottom: 0;
            z-index: 2;
            box-shadow: 0 4px 6px rgba(0,0,0,0.3) inset;
        }

        /* City Name Label */
        .city-label {
            position: absolute;
            bottom: -25px;
            width: 100%;
            text-align: center;
            color: white;
            font-weight: bold;
            font-size: 1.1em;
            text-shadow: 1px 1px 2px black;
            z-index: 3;
        }

        /* The Cute Mole */
        .mole {
            width: 80px;
            height: 90px;
            background: #a1887f; /* Mole fur color */
            border-radius: 40px 40px 10px 10px;
            position: absolute;
            bottom: 15px; /* Hidden position */
            left: 20px;
            transform: translateY(100%);
            transition: transform 0.4s cubic-bezier(0.6, -0.28, 0.735, 0.045); /* Pop down effect */
            z-index: 1; /* Behind the front of the hole */
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            pointer-events: none; /* Let clicks pass through to container */
        }

        /* Mole Face Details */
        .mole::before { /* Snout */
            content: '';
            width: 20px;
            height: 14px;
            background: #ffccbc;
            border-radius: 50%;
            position: absolute;
            top: 45px;
        }
        .mole::after { /* Eyes */
            content: '';
            width: 6px;
            height: 6px;
            background: #333;
            border-radius: 50%;
            position: absolute;
            top: 35px;
            left: 28px;
            box-shadow: 18px 0 0 #333;
        }

        /* Info Board held by Mole */
        .mole-info {
            background: white;
            padding: 5px;
            border-radius: 8px;
            text-align: center;
            font-size: 0.75em;
            border: 2px solid #333;
            position: absolute;
            top: -50px;
            width: 100px;
            opacity: 0;
            transition: opacity 0.2s;
            pointer-events: auto;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }

        .mole-info strong {
            display: block;
            color: #d84315;
            font-size: 1.2em;
        }

        /* Active State (Mole Pops Up) */
        .hole-container.active .mole {
            transform: translateY(0);
            transition: transform 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275); /* Bouncy pop up */
        }

        .hole-container.active .mole-info {
            opacity: 1;
            transition-delay: 0.3s;
        }

        /* Loading State */
        #loading {
            color: white;
            font-size: 1.5em;
            animation: pulse 1s infinite;
        }

        @keyframes pulse {
            0% { opacity: 0.5; }
            100% { opacity: 1; }
        }
    </style>
</head>
<body>

    <h1>üåßÔ∏è Weather Whack-a-Mole üå§Ô∏è</h1>
    <div id="loading">Scouting for moles...</div>
    <div id="game-board" class="game-board"></div>

    <script>
        const API_URL = 'http://hex-final.zeabur.app/api/weather'; // Adjust if backend port differs
        const board = document.getElementById('game-board');
        const loading = document.getElementById('loading');
        let citiesData = [];
        let autoPlayTimeout = null;

        // Fetch Weather Data
        async function fetchWeather() {
            try {
                const res = await fetch(API_URL);
                const data = await res.json();
                
                if (data.success) {
                    citiesData = data.data;
                    renderHoles();
                    loading.style.display = 'none';
                }
            } catch (err) {
                loading.innerText = "Error loading weather. Check backend!";
                console.error(err);
            }
        }

        // Create the Grid
        function renderHoles() {
            board.innerHTML = '';
            citiesData.forEach((city, index) => {
                const container = document.createElement('div');
                container.className = 'hole-container';
                container.dataset.index = index;

                // Structure: Mole (with info) -> Hole (mask) -> Label
                container.innerHTML = `
                    <div class="mole">
                        <div class="mole-info">
                            <strong>${city.minTemp} - ${city.maxTemp}</strong>
                            <div>${city.condition}</div>
                            <div>‚òî ${city.pop}</div>
                        </div>
                    </div>
                    <div class="hole"></div>
                    <div class="city-label">${city.name}</div>
                `;

                // Click event for this hole
                container.addEventListener('click', (e) => {
                    e.stopPropagation(); // Stop click from reaching body
                    activateMole(index);
                });

                board.appendChild(container);
            });
        }

        // Show specific mole
        function activateMole(index) {
            clearTimeout(autoPlayTimeout); // Stop auto-play temporarily
            
            // Hide all others first? Or allow multiple? 
            // "Whack a mole" usually has one or two. Let's reset others for focus.
            document.querySelectorAll('.hole-container').forEach(el => el.classList.remove('active'));

            const target = board.children[index];
            if (target) {
                target.classList.add('active');
            }
        }

        // Hide all moles
        function hideAllMoles() {
            const activeMoles = document.querySelectorAll('.hole-container.active');
            if (activeMoles.length > 0) {
                activeMoles.forEach(el => el.classList.remove('active'));
                
                // As per request: "once the user clicks elsewhere... another mole will appear"
                // We trigger a random mole after a short delay
                autoPlayTimeout = setTimeout(showRandomMole, 800);
            }
        }

        // Show a random mole (Game Logic)
        function showRandomMole() {
            if (citiesData.length === 0) return;
            const randomIdx = Math.floor(Math.random() * citiesData.length);
            activateMole(randomIdx);
        }

        // Global Click Listener (Clicking "elsewhere")
        document.addEventListener('click', (e) => {
            // If click is NOT on a hole-container
            if (!e.target.closest('.hole-container')) {
                hideAllMoles();
            }
        });

        // Initialize
        fetchWeather();

    </script>
</body>
</html>