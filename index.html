<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Taiwan Weather Whack-a-Mole</title>
    
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ğŸŒ¤ï¸</text></svg>">

    <style>
        :root {
            --ground-color: #8da25d;
            --hole-color: #3e2723; /* æ·±æ·±å’–å•¡è‰² (æ´) */
            --mole-color: #8d6e63; /* ç¶“å…¸åœ°é¼ è¤ */
            --mole-bonked: #e53935; /* è¢«æ‰“åˆ°çš„é®®ç´…è‰² */
        }

        body {
            margin: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            overflow-x: hidden;
            background-color: #87CEEB; /* å¤©ç©ºè— */
        }

        h1 {
            color: #fff;
            text-shadow: 2px 2px 0 #333;
            margin: 20px 0;
            z-index: 10;
            text-align: center;
            font-size: 1.8rem;
        }

        /* --- åœ°åœ–å®¹å™¨ --- */
        .map-container {
            position: relative;
            width: 95%;
            max-width: 600px;
            aspect-ratio: 0.65; /* ç¶­æŒå°ç£å½¢ç‹€æ¯”ä¾‹ */
            margin-bottom: 50px;
        }

        /* --- ğŸŒŸ é—œéµä¿®æ­£ï¼šå…§åµŒå¼ç™½è‰²åœ°åœ–èƒŒæ™¯ --- */
        /* ä¸å†ä¾è³´å¤–éƒ¨é€£çµæˆ–æ¿¾é¡ï¼Œç›´æ¥ä½¿ç”¨ç·¨ç¢¼éçš„ç™½è‰²åœ°åœ– */
        .map-container::before {
            content: "";
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            
            /* é€™è£¡æ˜¯ä¸€é•·ä¸²ç·¨ç¢¼éçš„ SVGï¼Œå·²ç¶“é è¨­ç‚ºåŠé€æ˜ç™½è‰² */
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 438 677'%3E%3Cg fill='%23ffffff' fill-opacity='0.5'%3E%3Cpath d='M428.3 262.4c-2.1-6.1-12.1-12.6-14.4-18.2-2.1-5.2.2-15.1-2.4-20-2.8-5.2-11.5-7.7-14.4-13.2-1.9-3.7-1.3-11.1-3.7-14.7-3.5-5.2-13.5-6.6-16.7-12.4-2.2-3.9-.8-11.9-3.2-15.7-3.2-5.2-12.7-7.5-15.8-12.8-2.2-3.7-.8-11.8-3.4-15.7-3.4-5.2-13.3-6.9-16.3-12.7-1.9-3.7-.8-11.3-3.1-15.2-2.8-4.8-11.4-7.2-14.6-12.1-2.5-3.9-1.8-11.8-4.5-15.7-3.8-5.5-14.6-6.1-17.8-12-2.1-3.9-1-12.1-3.7-15.8-3.9-5.5-14.8-5.5-18.4-11.2-2.2-3.6-1.5-11.4-3.8-15.1-3.5-5.6-13.4-6.9-16.6-12.6-2.1-3.7-1.1-11.3-3.4-15.1-3.2-5.3-12.7-7.3-16.1-12.6-2.4-3.8-1.8-11.4-4.4-15.2-4.1-5.8-15.4-5-18.9-11.2-1.9-3.2-1.5-10.1-3.5-13.3-2.8-4.6-10.7-6.6-14-11.2-3-4.2-2.8-13-6.1-16.9-4.2-5.1-15.9-3.3-19.6-8.9C116.9 6.6 118 0 115.2 0c-3.7 0-10.6 6.6-15.7 6.6-6.1 0-10.5-6.6-17.2-6.6-3 0-8.9 2.9-11.3 5.3-5 5-4.7 15.8-10.4 19.8-4.6 3.2-13.2 1.3-18.4 3.9-5.4 2.6-7.9 10.6-12.8 14.6-5.1 4.2-14.3 4.6-18.8 9.7-4 4.6-2.8 14.1-6.2 19.3-4.1 6.4-13.9 9-16.9 15.8-2.2 5-.2 14.6-2.7 19.4-3.5 6.5-12.9 9.6-15.5 16.6-1.7 4.7.5 13.8-1.4 18.4-3.2 7.7-14.1 10.8-16.3 18.8-1.3 4.8 1.5 13.3.2 18.2-2.9 9.5-16 12.7-17.3 22.6-.5 3.8 1.4 10.6.6 14.5-2.3 11.5-18.5 14.9-18.4 26.9 0 3.6 2.5 9.5 2.5 13.1 0 12.5-14.7 17.2-12.9 30.1.5 3.4 3.6 8.5 4.2 12 1.9 12.2-11.5 19.3-8 32.3 1 3.8 5 9 6.2 12.8 3.1 10.5-8.1 20.2-3.8 31.8 1.8 4.7 6.9 10.4 8.9 15 4.9 11-2.8 23.9 3.5 34.3 2.8 4.6 8.9 9.2 11.9 13.7 6.7 10 2.2 25.1 10.5 33.8 3.7 3.9 11.1 6.7 15 10.3 9.2 8.3 8.9 23.8 19.3 30.6 4.6 3 13.3 4.1 18.1 6.8 10.4 5.8 14.3 20.8 26.3 25 5 1.8 13.7.7 18.8 2.3 13 4.1 19 19.3 33.3 21.5 4.1.6 11.2-3.2 15.3-2.9 12.8.8 23 14.9 36.5 13.8 3.7-.3 9.7-6 13.3-6.8 14.6-3.1 27 8 42 2.5 4.1-1.5 8.5-8.4 12.5-10.2 9.7-4.3 23.7 3.9 33.2-1.8 6.4-3.8 6.4-16.9 13.6-19.6 5.6-2.1 15.3 1.3 20.2-.3 13-4.1 18.9-19.1 33.1-21.1 4.6-.7 12.1 3.1 16.5 2.1 11.8-2.8 20.3-16.4 33-17.5 5.5-.5 13.4 4.1 18.7 3.4 11.4-1.5 22.2-13.3 33.9-13.1 2.9 0 7.9 2.4 10.7 2.2 14-1.3 22-17 35-20.2 2.5-.6 6.9 1.3 9.3.6 12.1-3.6 19.3-18.6 30.8-23.7 3.2-1.4 8.9 0 12.1-1.6 12.1-6.1 17.2-21.5 28.3-29.2 2.9-2 8.5-1.2 11.4-3.3 12.2-8.9 14.9-25.3 26-35.6 2.1-1.9 6.3-2.7 8.5-4.7 11.2-10.4 14.8-27 24.8-38.6 2.2-2.6 7.2-2.9 9.4-5.6 12.2-15.1 10.8-35.3 21.8-50.1 2.2-3 7.7-3 10-6 12.1-16.1 9.6-37.3 20.2-53.5 1.9-3 7.3-3.7 9.3-6.7 10.4-15.7 9.8-35.2 19-51.6 2.5-4.5 8.8-4.3 11.4-9 7-12.6 10.3-26.6 16.1-39.9z'/%3E%3C/g%3E%3C/svg%3E");
            background-size: contain;
            background-repeat: no-repeat;
            background-position: center;
            
            z-index: 0; /* åœ¨æœ€åº•å±¤ */
            pointer-events: none; 
        }

        /* --- æ´çš„ä½ç½® --- */
        .hole-container {
            position: absolute;
            width: 60px;
            height: 60px;
            transform: translate(-50%, -50%);
            cursor: pointer;
            z-index: 1; /* æ¯”åœ°åœ–é«˜ */
        }

        /* è¢«å•Ÿç”¨æ™‚å±¤ç´šæœ€é«˜ */
        .hole-container.active { z-index: 1000; }

        /* --- æ´ç©´ --- */
        .hole {
            width: 100%;
            height: 24px;
            background: var(--hole-color);
            border-radius: 50%;
            position: absolute;
            bottom: 15px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.5) inset;
            z-index: 1; 
        }

        /* --- åŸå¸‚æ¨™ç±¤ --- */
        .city-label {
            position: absolute;
            top: 10px;
            width: 80px;
            left: 50%;
            transform: translateX(-50%);
            text-align: center;
            color: #fff;
            font-weight: bold;
            font-size: 13px;
            text-shadow: 1.5px 1.5px 0 #000, -1.5px -1.5px 0 #000;
            pointer-events: none;
            z-index: 3;
        }

        /* --- åœ°é¼ æœ¬é«” --- */
        .mole {
            width: 44px;
            height: 50px;
            background: var(--mole-color);
            border-radius: 22px 22px 10px 10px;
            position: absolute;
            bottom: 25px;
            left: 50%;
            
            transform: translateX(-50%) scale(0.1);
            opacity: 0;
            
            transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            z-index: 2;
            display: flex;
            justify-content: center;
        }

        /* é¼»å­ */
        .mole::before { 
            content: ''; width: 14px; height: 10px; 
            background: #d7ccc8;
            border-radius: 50%; position: absolute; top: 22px;
        }
        
        /* çœ¼ç› */
        .mole::after { 
            content: ''; width: 5px; height: 5px; 
            background: #333;
            border-radius: 50%; position: absolute; top: 15px; left: 12px;
            box-shadow: 14px 0 0 #333;
        }

        /* --- è¢«æ‰“åˆ°çš„ç‹€æ…‹ --- */
        .mole.bonked { 
            background: var(--mole-bonked);
        }
        .mole.bonked::after {
            content: 'x x';
            background: transparent; box-shadow: none;
            font-size: 14px; font-weight: bold; top: 12px; left: 50%;
            transform: translateX(-50%);
            color: #fff; letter-spacing: 2px;
        }

        /* æ­ªé ­å€’ä¸‹å‹•ç•« */
        .hole-container.active .mole.bonked {
            transform: translateX(-50%) rotate(25deg) translateY(5px);
            transition: transform 0.1s;
        }

        /* --- è³‡è¨Šç‰Œ --- */
        .mole-info {
            background: white;
            padding: 5px 8px;
            border-radius: 8px;
            text-align: center;
            font-size: 12px;
            border: 2px solid #333;
            position: absolute;
            top: -75px;
            width: 90px;
            left: 50%;
            transform: translateX(-50%) scale(0.8);
            opacity: 0;
            pointer-events: none;
            transition: all 0.3s;
            box-shadow: 0 4px 8px rgba(0,0,0,0.3);
        }
        .mole-info strong { color: #d84315; font-size: 1.1em; display: block; margin-bottom: 2px;}

        /* å½ˆå‡ºå‹•ç•« */
        .hole-container.active .mole { 
            transform: translateX(-50%) scale(1); 
            opacity: 1;
        }
        .hole-container.active .mole-info { 
            opacity: 1; 
            transform: translateX(-50%) scale(1);
        }

        #loading {
            color: white; font-size: 1.5em; text-shadow: 1px 1px 2px #333; position: absolute; top: 50%;
        }

        /* --- æ‰‹æ©Ÿç‰ˆ --- */
        @media (max-width: 600px) {
            .hole-container { width: 36px; height: 36px; }
            .hole { height: 14px; bottom: 8px; }
            .city-label { font-size: 10px; top: 4px; }
            .mole { width: 28px; height: 34px; bottom: 14px; border-radius: 14px 14px 6px 6px; }
            .mole::before { width: 8px; height: 6px; top: 14px; }
            .mole::after { width: 3px; height: 3px; top: 10px; left: 8px; box-shadow: 9px 0 0 #333; }
            .mole.bonked::after { font-size: 10px; top: 8px; letter-spacing: 1px; }
            .mole-info { top: -60px; width: 75px; font-size: 10px; padding: 4px; }
        }
    </style>
</head>
<body>

    <h1>ğŸŒ§ï¸ Weather Whack-a-Mole ğŸŒ¤ï¸</h1>
    <div id="loading">Scouting for moles...</div>
    <div id="game-board" class="map-container"></div>

    <script>
        // âš ï¸ ä½¿ç”¨ä½ çš„ Zeabur HTTPS URL
        const API_URL = 'https://hex-final.zeabur.app/api/weather'; 
        
        const board = document.getElementById('game-board');
        const loading = document.getElementById('loading');
        let citiesData = [];
        let autoPlayTimeout = null;

        // ğŸ—ºï¸ å°ç£åœ°åœ–åº§æ¨™ (Top%, Left%)
        const coordinates = {
            "åŸºéš†å¸‚": { t: 5, l: 72 },
            "è‡ºåŒ—å¸‚": { t: 8, l: 68 },
            "æ–°åŒ—å¸‚": { t: 12, l: 70 },
            "æ¡ƒåœ’å¸‚": { t: 10, l: 55 },
            "æ–°ç«¹å¸‚": { t: 16, l: 50 },
            "æ–°ç«¹ç¸£": { t: 18, l: 58 },
            "è‹—æ —ç¸£": { t: 22, l: 48 },
            "è‡ºä¸­å¸‚": { t: 30, l: 42 },
            "å½°åŒ–ç¸£": { t: 36, l: 38 },
            "å—æŠ•ç¸£": { t: 38, l: 55 },
            "é›²æ—ç¸£": { t: 45, l: 35 },
            "å˜‰ç¾©å¸‚": { t: 50, l: 38 },
            "å˜‰ç¾©ç¸£": { t: 50, l: 45 },
            "è‡ºå—å¸‚": { t: 60, l: 32 },
            "é«˜é›„å¸‚": { t: 70, l: 35 },
            "å±æ±ç¸£": { t: 80, l: 45 },
            "å®œè˜­ç¸£": { t: 20, l: 80 },
            "èŠ±è“®ç¸£": { t: 40, l: 75 },
            "è‡ºæ±ç¸£": { t: 70, l: 65 },
            "æ¾æ¹–ç¸£": { t: 45, l: 10 },
            "é‡‘é–€ç¸£": { t: 15, l: 5 },
            "é€£æ±Ÿç¸£": { t: 2, l: 30 }
        };

        async function fetchWeather() {
            try {
                const res = await fetch(API_URL);
                const data = await res.json();
                
                if (data.success) {
                    citiesData = data.data;
                    renderMap();
                    loading.style.display = 'none';
                }
            } catch (err) {
                loading.innerText = "Error loading weather. Check backend!";
                console.error(err);
            }
        }

        function renderMap() {
            board.innerHTML = '';
            // é€™è£¡ä¸éœ€è¦é‡è¨­ classï¼Œå› ç‚º HTML å·²ç¶“é è¨­å¥½ map-container äº†

            citiesData.forEach((city, index) => {
                const coords = coordinates[city.name] || { t: 50, l: 50 };

                const container = document.createElement('div');
                container.className = 'hole-container';
                container.dataset.index = index;
                
                // å®šä½
                container.style.top = coords.t + '%';
                container.style.left = coords.l + '%';

                container.innerHTML = `
                    <div class="mole" id="mole-${index}">
                        <div class="mole-info">
                            <strong>${city.minTemp}-${city.maxTemp}</strong>
                            <div>${city.condition}</div>
                            <div>â˜” ${city.pop}</div>
                        </div>
                    </div>
                    <div class="hole"></div>
                    <div class="city-label">${city.name}</div>
                `;

                // é»æ“Šäº‹ä»¶
                container.addEventListener('click', (e) => {
                    e.stopPropagation();
                    whackMole(index);
                });

                board.appendChild(container);
            });
        }

        function whackMole(index) {
            clearTimeout(autoPlayTimeout);
            
            // 1. é‡ç½®å…¶ä»–åœ°é¼ 
            document.querySelectorAll('.hole-container').forEach(el => el.classList.remove('active'));
            document.querySelectorAll('.mole').forEach(el => el.classList.remove('bonked'));

            // 2. è§¸ç™¼ç›®æ¨™åœ°é¼ 
            const targetContainer = board.children[index];
            const targetMole = targetContainer.querySelector('.mole');

            if (targetContainer) {
                targetContainer.classList.add('active'); // å½ˆå‡º
                targetMole.classList.add('bonked');      // è®Šè‰²+æ­»æ‰
                
                // 0.5ç§’å¾Œè®Šå›æ­£å¸¸é¡è‰² (ä½†ä¿æŒå½ˆå‡ºç‹€æ…‹æ–¹ä¾¿çœ‹å­—)
                setTimeout(() => {
                    targetMole.classList.remove('bonked');
                }, 500);
            }
        }

        function hideAllMoles() {
            const activeMoles = document.querySelectorAll('.hole-container.active');
            if (activeMoles.length > 0) {
                activeMoles.forEach(el => el.classList.remove('active'));
                
                // è‡ªå‹•éš¨æ©Ÿå‡ºç¾ä¸‹ä¸€éš»
                autoPlayTimeout = setTimeout(showRandomMole, 1000);
            }
        }

        function showRandomMole() {
            if (citiesData.length === 0) return;
            
            const randomIdx = Math.floor(Math.random() * citiesData.length);
            
            // å…ˆéš±è—å…¶ä»–çš„
            document.querySelectorAll('.hole-container').forEach(el => el.classList.remove('active'));
            
            // éš¨æ©Ÿå½ˆå‡º (ä¸å¸¶ bonked ç´…è‰²)
            const target = board.children[randomIdx];
            if(target) target.classList.add('active');
        }

        // é»æ“ŠèƒŒæ™¯éš±è—
        document.addEventListener('click', (e) => {
            if (!e.target.closest('.hole-container')) {
                hideAllMoles();
            }
        });

        // é–‹å§‹
        fetchWeather();
    </script>
</body>
</html>